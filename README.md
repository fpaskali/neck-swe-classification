# "Specification of neck muscle dysfunction through digital image analysis using machine learning"

This is a repository of the python code used in the paper [LINK].

## Description ##

## User Manual ##

### Installation of required packages ###
    pip install -r requirements.txt
    
### General recommendations ###

#### Folder structure ####
The folder structure could be easily customized within the scripts. The here presented structure is merely a suggestion.

It is recommended, the scripts to be placed in a directory, together with the following folders:
* data - directory that contains csv files with data information and data/images contains the raw image data.
* figures - directory that contains all graphs generated by scripts with matplotlib.
* tables - directory that contains csv tables generated by scripts.

#### CSV file ####

The scripts require a csv file that contains imaging following the proposed structure. 

* subject - the id of the subject.
* repeat - the number of the imaging session.
* group - the pain or control. (e.g. pain = 0, control = 1)
* task1_E - path to the elastrography image file.
* task2_Q - path to the quality map file.

The number of columns is not limited, but additional columns should always be added in pairs of elastography images and quality maps.

| subject | repeat | group | task1_E                   | task1_Q                   | task2_E                   | task2_Q                   |
|---------|--------|-------|---------------------------|---------------------------|---------------------------|---------------------------|
| 1       | 1      | 0     | data/images/imageE001.BMP | data/images/imageQ001.BMP | data/images/imageE007.BMP | data/images/imageQ007.BMP | 
| 1       | 2      | 0     | data/images/imageE002.BMP | data/images/imageQ002.BMP | data/images/imageE007.BMP | data/images/imageQ008.BMP | 
| 1       | 3      | 0     | data/images/imageE003.BMP | data/images/imageQ003.BMP | data/images/imageE009.BMP | data/images/imageQ009.BMP | 
| 2       | 1      | 1     | data/images/imageE004.BMP | data/images/imageQ004.BMP | data/images/imageE010.BMP | data/images/imageQ010.BMP | 
| 2       | 2      | 1     | data/images/imageE005.BMP | data/images/imageQ005.BMP | data/images/imageE011.BMP | data/images/imageQ011.BMP | 
| 2       | 3      | 1     | data/images/imageE006.BMP | data/images/imageQ006.BMP | data/images/imageE012.BMP | data/images/imageQ012.BMP | 

### Scripts manual ####

#### Summary Image Generator (summary_image_generator_RGB.py) ####

This script generates mean, median, std and median absolute deviation(MAD) summary image, by applying the above operations to the RGB values of the shear wave elastography images for the both groups. 

Usage:

    summary_image.py [-h] [-csv CSV] [-r]
    

    Summary image generator

    optional arguments:
     -h, --help  show this help message and exit
     -csv CSV    CSV file with images info.
     -r          Remove all images with less than 50 percent colored pixels.

    Example:
    python summary_image.py -csv data/dataset.csv

#### SWE image feature extractor (swe_image_feature_extractor.py) ####
The script extracts features from the shear wave elastography images such as mean, median, number of red pixels etc., from the whole image or from horizontal segments.
Additionally, the percentage of color pixels is calculated in each image and there is an option to remove images with less than 50% colored pixels.

Usage: 

    swe_image_feature_extractor.py [-h] [-csv CSV] [-roi] [-seg] [-remove] [-bottom]

    Feature extraction script.

    options:
      -h, --help  show this help message and exit
      -csv CSV    path to dataset csv file.
      -roi        Extract features of roi.
      -seg        Segment roi and extract features.
      -remove     Remove images with less than 50 percent colored pixels.
      -bottom     Extract features from bottom part only.

        Example usage:
        python various_feature_extractor.py -csv data/dataset.csv -roi


### Notebooks ###
The notebooks can be loaded in JupyterLab or Jupyter Notebook.

#### Machine Learning with Grid Search (MachineLearningWithGridSearch.ipynb) #### 
Evaluation of six machine learning models with hyper-parameter optimization and nested cross-validation.

#### Random Forest Best Features Extraction (RandomForestBestFeatures.ipynb) ####
Extracting impurity base feature importances from cross-validation of Random Forest Classifier. 
